<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SaAI Response Formatting Test</title>
    <style>
        /* Import Inter Font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        /* CSS Variables for consistent theming */
        :root {
            --saai-primary: #0f172a;
            --saai-primary-light: #1e293b;
            --saai-text-primary: #0f172a;
            --saai-text-secondary: #64748b;
            --saai-text-muted: #94a3b8;
            --saai-background: #ffffff;
            --saai-background-secondary: #f8fafc;
            --saai-border: #e2e8f0;
            --saai-border-light: #f1f5f9;
            --saai-accent: #f1f5f9;
            --saai-accent-hover: #e2e8f0;
            --saai-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --saai-shadow-lg: 0 4px 6px rgba(0, 0, 0, 0.1);
            --saai-border-radius: 12px;
            --saai-border-radius-lg: 16px;
            --saai-transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #f8fafc;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: var(--saai-primary);
            color: white;
            padding: 24px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 24px;
            font-weight: 600;
        }

        .content {
            padding: 32px;
        }

        .section {
            margin-bottom: 32px;
        }

        .section h2 {
            color: var(--saai-primary);
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--saai-border-light);
        }

        .raw-text {
            background: #f1f5f9;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            line-height: 1.5;
            color: var(--saai-text-primary);
            border-left: 4px solid var(--saai-border);
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 300px;
            overflow-y: auto;
        }

        /* === FORMATTED RESPONSE STYLES === */

        /* Container for formatted responses */
        .formatted-response {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--saai-text-primary);
            background: var(--saai-background);
            border-radius: var(--saai-border-radius);
            overflow: hidden;
        }

        /* Response headers (markdown ### headers) */
        .response-header {
            color: var(--saai-primary);
            font-size: 18px;
            font-weight: 600;
            margin: 24px 0 16px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--saai-border-light);
        }

        /* Section headers with numbered items */
        .response-section {
            margin-bottom: 16px;
            padding: 12px 16px;
            background: var(--saai-background-secondary);
            border-radius: 8px;
            border-left: 4px solid var(--saai-primary);
        }

        .section-header {
            margin-bottom: 8px;
        }

        .section-number {
            font-weight: 600;
            color: var(--saai-primary);
            font-size: 14px;
        }

        .section-content {
            color: var(--saai-text-primary);
            font-size: 13px;
            line-height: 1.5;
        }

        /* Field labels (bold headers) */
        .field-label {
            color: var(--saai-primary);
            font-weight: 600;
            font-size: 13px;
            display: inline-block;
            margin-right: 8px;
        }

        /* Highlighted text */
        .highlight {
            color: var(--saai-primary);
            font-weight: 600;
            background: rgba(15, 23, 42, 0.05);
            padding: 2px 6px;
            border-radius: 4px;
        }

        /* Vendor responses section */
        .vendor-section {
            margin: 16px 0;
            padding: 16px;
            background: #f0f9ff;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }

        .vendor-list {
            margin-top: 8px;
        }

        .vendor-response {
            margin: 6px 0;
            padding: 8px 12px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 6px;
            font-size: 13px;
            color: var(--saai-text-primary);
            border-left: 3px solid #3b82f6;
        }

        /* Next steps section */
        .next-steps-section {
            margin: 16px 0;
            padding: 16px;
            background: #f0fdf4;
            border-radius: 8px;
            border-left: 4px solid #22c55e;
        }

        .steps-list {
            margin-top: 8px;
        }

        .next-step {
            margin: 6px 0;
            padding: 8px 12px;
            background: rgba(34, 197, 94, 0.1);
            border-radius: 6px;
            font-size: 13px;
            color: var(--saai-text-primary);
            border-left: 3px solid #22c55e;
        }

        /* Numbered items */
        .numbered-item {
            display: flex;
            margin: 12px 0;
            padding: 12px 16px;
            background: var(--saai-background-secondary);
            border-radius: 8px;
            border: 1px solid var(--saai-border-light);
        }

        .item-number {
            font-weight: 600;
            color: var(--saai-primary);
            margin-right: 12px;
            min-width: 24px;
            font-size: 14px;
        }

        .item-content {
            color: var(--saai-text-primary);
            font-size: 13px;
            line-height: 1.5;
            flex: 1;
        }

        /* List items */
        .list-item {
            margin: 6px 0;
            padding: 6px 12px;
            background: var(--saai-background-secondary);
            border-radius: 6px;
            font-size: 13px;
            color: var(--saai-text-primary);
            border-left: 3px solid var(--saai-border);
        }

        /* Citations and references */
        .citation {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            margin: 0 2px;
        }

        /* News headlines */
        .news-headline {
            margin: 20px 0;
            padding: 20px;
            background: #fef7ff;
            border-radius: 12px;
            border-left: 6px solid #a855f7;
            box-shadow: 0 2px 8px rgba(168, 85, 247, 0.1);
        }

        .news-label {
            color: #7c3aed;
            font-weight: 700;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-right: 12px;
        }

        .news-content {
            color: var(--saai-text-primary);
            font-size: 15px;
            line-height: 1.6;
            font-weight: 500;
        }

        /* Content paragraphs */
        .content-paragraph {
            margin: 16px 0;
            padding: 16px;
            background: var(--saai-background-secondary);
            border-radius: 8px;
            border-left: 4px solid var(--saai-border);
            line-height: 1.6;
            font-size: 14px;
            color: var(--saai-text-primary);
        }

        /* Sources section */
        .sources-section {
            margin: 24px 0;
            padding: 20px;
            background: #fef3c7;
            border-radius: 8px;
            border-left: 4px solid #f59e0b;
        }

        .sources-list {
            margin-top: 12px;
        }

        .source-item {
            margin: 8px 0;
            padding: 12px;
            background: rgba(245, 158, 11, 0.1);
            border-radius: 6px;
            border-left: 3px solid #f59e0b;
        }

        .source-name {
            display: block;
            font-weight: 600;
            color: var(--saai-primary);
            margin-bottom: 4px;
            font-size: 13px;
        }

        .source-link {
            display: block;
            color: #d97706;
            text-decoration: none;
            font-size: 12px;
            word-break: break-all;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }

        .source-link:hover {
            color: #b45309;
            text-decoration: underline;
        }

        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-top: 24px;
        }

        .comparison-item h3 {
            color: var(--saai-primary);
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .comparison {
                grid-template-columns: 1fr;
                gap: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>SaAI Response Formatting Test</h1>
        </div>
        
        <div class="content">
            <div class="section">
                <h2>Sample Response #1 - Simple Text</h2>
                <p>This demonstrates how simple text responses are formatted for better readability.</p>
            </div>
            
            <div class="comparison">
                <div class="comparison-item">
                    <h3>ðŸ”´ Raw Response (Before)</h3>
                    <div class="raw-text" id="raw-response-1"></div>
                </div>
                
                <div class="comparison-item">
                    <h3>âœ… Formatted Response (After)</h3>
                    <div class="formatted-response" id="formatted-response-1"></div>
                </div>
            </div>
            
                         <div class="section">
                 <h2>Sample Response #2 - Markdown with Headers & Sources</h2>
                 <p>This demonstrates how markdown-formatted responses with headers, citations, and source links are formatted.</p>
             </div>
             
             <div class="comparison">
                 <div class="comparison-item">
                     <h3>ðŸ”´ Raw Response (Before)</h3>
                     <div class="raw-text" id="raw-response-2"></div>
                 </div>
                 
                 <div class="comparison-item">
                     <h3>âœ… Formatted Response (After)</h3>
                     <div class="formatted-response" id="formatted-response-2"></div>
                 </div>
             </div>
             
             <div class="section">
                 <h2>Sample Response #3 - Device Description (Fixed Case)</h2>
                 <p>This demonstrates how the extension now correctly handles device names with numbers without incorrectly formatting them as numbered lists.</p>
             </div>
             
             <div class="comparison">
                 <div class="comparison-item">
                     <h3>ðŸ”´ Raw Response (Before)</h3>
                     <div class="raw-text" id="raw-response-3"></div>
                 </div>
                 
                 <div class="comparison-item">
                     <h3>âœ… Formatted Response (After)</h3>
                     <div class="formatted-response" id="formatted-response-3"></div>
                 </div>
             </div>
        </div>
    </div>

    <script>
                 // Sample response #1 - Simple text
         const sampleResponse1 = `Based on the email thread regarding the NeuroTrack NX-500 replacement, a tracking ID wasn't explicitly mentioned. The support team requested for an inspection to be scheduled before proceeding with the replacement. If you have any more specific keywords or information, I can refine the search.`;

         // Sample response #3 - Device description (the problematic case)
         const sampleResponse3 = `The device reported as defective in the warranty claim is the NeuroTrack NX-500. The issue was that the device stopped functioning and was no longer powering on, despite troubleshooting attempts.`;

        // Sample response #2 - Markdown with headers and sources
        const sampleResponse2 = `### News
Google DeepMind's Nano Banana, now known as Gemini 2.5 Flash Image, advances AI image generation and editing, enabling users to create photorealistic images with consistent character likeness using natural language prompts [1][2]. Its capabilities span various applications, making it one of the leading models in the field.

### Sources:
1. [Introducing Gemini 2.5 Flash Image](https://developers.googleblog.com/en/introducing-gemini-2-5-flash-image/)
2. [YouTube Video 1](https://www.youtube.com/watch?v=QGvRZmG_ZKA)
3. [YouTube Video 2](https://www.youtube.com/watch?v=m8Ve7hNl9P0)
4. [PC Gamer Article](https://www.pcgamer.com/software/ai/geminis-nano-banana-update-aims-to-keep-people-looking-the-same-in-ai-art-and-the-fear-of-deepfakes-makes-me-want-to-wear-a-brown-paper-bag-on-my-head-forever-more/)
5. [Tutorial on Nano Banana](https://www.anangsha.me/nano-banana-tutorial-how-to-use-googles-ai-image-editing-model-in-2025/)`;

                 // Display raw responses
         document.getElementById('raw-response-1').textContent = sampleResponse1;
         document.getElementById('raw-response-2').textContent = sampleResponse2;
         document.getElementById('raw-response-3').textContent = sampleResponse3;

        // Enhanced formatting function that handles both simple text and markdown responses
        function formatUnstructuredResponse(text) {
            if (!text || typeof text !== 'string') {
                return text;
            }
            
            let formattedText = text;
            
            // 1. Format markdown headers (e.g., "### News", "### Sources:")
            formattedText = formattedText.replace(/^###\s+(.+)$/gm, '<h3 class="response-header">$1</h3>');
            
            // 2. Format numbered lists (e.g., "1. **Device**: ...")
            formattedText = formattedText.replace(/(\d+\.\s+\*\*([^*]+)\*\*:\s*([^2-9]+?)(?=\d+\.\s+\*\*|$))/g, 
                '<div class="response-section"><div class="section-header"><span class="section-number">$1</span></div><div class="section-content">$3</div></div>'
            );
            
            // 3. Format bold headers (e.g., "**Device**:", "**Fault**:")
            formattedText = formattedText.replace(/\*\*([^*]+)\*\*:\s*/g, '<strong class="field-label">$1:</strong> ');
            
            // 4. Format vendor responses section
            formattedText = formattedText.replace(/(\*\*Vendor Responses\*\*:\s*)(.*?)(?=\*\*Next Steps\*\*|$)/s, (match, header, content) => {
                const vendorResponses = content.split('-').filter(item => item.trim());
                if (vendorResponses.length > 0) {
                    const formattedResponses = vendorResponses.map(response => {
                        const trimmed = response.trim();
                        if (trimmed) {
                            return `<div class="vendor-response">â€¢ ${trimmed}</div>`;
                        }
                        return '';
                    }).join('');
                    return `<div class="vendor-section"><strong class="field-label">Vendor Responses:</strong><div class="vendor-list">${formattedResponses}</div></div>`;
                }
                return match;
            });
            
            // 5. Format next steps section
            formattedText = formattedText.replace(/(\*\*Next Steps\*\*:\s*)(.*?)(?=\*\*|$)/s, (match, header, content) => {
                const steps = content.split(',').filter(step => step.trim());
                if (steps.length > 0) {
                    const formattedSteps = steps.map(step => {
                        const trimmed = step.trim();
                        if (trimmed) {
                            return `<div class="next-step">â€¢ ${trimmed}</div>`;
                        }
                        return '';
                    }).join('');
                    return `<div class="next-steps-section"><strong class="field-label">Next Steps:</strong><div class="steps-list">${formattedSteps}</div></div>`;
                }
                return match;
            });
            
            // 6. Format any remaining numbered items that weren't caught
            formattedText = formattedText.replace(/(\d+\.\s+)([^1-9]+?)(?=\d+\.\s+|$)/g, 
                '<div class="numbered-item"><span class="item-number">$1</span><span class="item-content">$2</span></div>'
            );
            
            // 7. Add general styling classes
            formattedText = formattedText.replace(/\*\*([^*]+)\*\*/g, '<strong class="highlight">$1</strong>');
            
            // 8. Format any remaining lists or bullet points
            formattedText = formattedText.replace(/([â€¢\-\*]\s+)([^\n]+)/g, '<div class="list-item">$1$2</div>');
            
            // 9. Format citations/references like [1][2] or [4]
            formattedText = formattedText.replace(/\[(\d+)\]/g, '<span class="citation">[$1]</span>');
            
            // 10. Format source links section at the end (multiple formats)
            formattedText = formattedText.replace(/(Sources?:?\s*)(.*?)$/s, (match, header, content) => {
                // Try different source formats
                let formattedSources = [];
                
                // Format 1: [Name](URL) format
                const nameUrlMatches = content.match(/\d+\.\s+\[([^\]]+)\]\(([^)]+)\)/g);
                if (nameUrlMatches) {
                    nameUrlMatches.forEach(match => {
                        const nameMatch = match.match(/\[([^\]]+)\]\(([^)]+)\)/);
                        if (nameMatch) {
                            formattedSources.push(`<div class="source-item"><span class="source-name">${nameMatch[1]}</span><a href="${nameMatch[2]}" target="_blank" class="source-link">${nameMatch[2]}</a></div>`);
                        }
                    });
                }
                
                // Format 2: [1]: URL format (for news summaries)
                if (formattedSources.length === 0) {
                    const numberUrlMatches = content.match(/\[(\d+)\]:\s*(https?:\/\/[^\s]+)/g);
                    if (numberUrlMatches) {
                        numberUrlMatches.forEach(match => {
                            const numberUrlMatch = match.match(/\[(\d+)\]:\s*(https?:\/\/[^\s]+)/);
                            if (numberUrlMatch) {
                                formattedSources.push(`<div class="source-item"><span class="source-name">Source ${numberUrlMatch[1]}</span><a href="${numberUrlMatch[2]}" target="_blank" class="source-link">${numberUrlMatch[2]}</a></div>`);
                            }
                        });
                    }
                }
                
                if (formattedSources.length > 0) {
                    return `<div class="sources-section"><strong class="field-label">${header}</strong><div class="sources-list">${formattedSources.join('')}</div></div>`;
                }
                return match;
            });
            
            // 11. Format news headlines (e.g., "News: Google has launched...")
            formattedText = formattedText.replace(/^(News:\s*)([^[]+?)(?=\[|$)/gm, (match, prefix, content) => {
                if (content.trim().length > 10) {
                    return `<div class="news-headline"><strong class="news-label">${prefix}</strong><span class="news-content">${content.trim()}</span></div>`;
                }
                return match;
            });
            
            // 12. Format paragraphs for better readability
            formattedText = formattedText.replace(/([^<>]+?)(?=\n\n|\n\s*\n|$)/g, (match, content) => {
                // Skip if this is already formatted HTML
                if (content.includes('<') && content.includes('>')) {
                    return content;
                }
                // Only format if it's substantial text (more than 50 characters)
                if (content.trim().length > 50 && !content.includes('Sources?:')) {
                    return `<div class="content-paragraph">${content.trim()}</div>`;
                }
                return content;
            });
            
            // 13. Add container wrapper
            formattedText = `<div class="formatted-response">${formattedText}</div>`;
            
            return formattedText;
        }

                 // Display formatted responses
         const formattedResponse1 = formatUnstructuredResponse(sampleResponse1);
         document.getElementById('formatted-response-1').innerHTML = formattedResponse1;
         
         const formattedResponse2 = formatUnstructuredResponse(sampleResponse2);
         document.getElementById('formatted-response-2').innerHTML = formattedResponse2;
         
         const formattedResponse3 = formatUnstructuredResponse(sampleResponse3);
         document.getElementById('formatted-response-3').innerHTML = formattedResponse3;
    </script>
</body>
</html>
